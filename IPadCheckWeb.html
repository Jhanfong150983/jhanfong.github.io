<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>平板借用與歸還系統</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        label { display: block; margin-top: 10px; }
        input, select, button { width: 100%; padding: 8px; margin-top: 5px; }
        .hidden { display: none; }
        .locked { background-color: #e0e0e0; pointer-events: none; }
        .tablet-id-container { display: flex; align-items: center; gap: 5px; }
        .tablet-id-container input { width: 45%; }
        .tablet-id-separator { font-size: 18px; font-weight: bold; }
        .button-group { display: flex; gap: 10px; margin-top: 10px; }
        .button-group button { flex: 1; }
    </style>
</head>
<body>
    <h2>平板借用與歸還</h2>
    
    <label for="class">班級：</label>
    <input type="text" id="class" placeholder="例如：305">
    
    <label for="seat">座號：</label>
    <input type="number" id="seat" placeholder="例如：12">
    
    <label for="tabletIdPrefix">平板編號：</label>
    <div class="tablet-id-container">
        <input type="text" id="tabletIdPrefix" placeholder="例如：G">
        <span class="tablet-id-separator">-</span>
        <input type="text" id="tabletIdNumber" placeholder="例如：18">
    </div>
    
    <label for="beforestatus">使用前狀況：</label>
    <select id="beforestatus">
        <option value="正常">正常，沒有任何問題</option>
        <option value="些微裂痕">平板有些微裂痕，但可以正常使用</option>
        <option value="面板破裂">平板有破裂，可能會割傷手指</option>
        <option value="無法使用">平板完全無法使用</option>
        <option value="其他1">其他（請自行填寫狀況）</option>
    </select>
    
    <input type="text" id="customStatus1" class="hidden" placeholder="請描述其他狀況">
    
    <button onclick="lockAndSubmit()">鎖定並提交借用紀錄</button>
    
    <h3>歸還檢查</h3>
    <div class="button-group">
        <button onclick="submitReturn('沒有問題')">沒有問題</button>
        <button onclick="reportIssue()">有問題</button>
    </div>
    
    <script>
        document.getElementById("beforestatus").addEventListener("change", function() {
            let customStatus = document.getElementById("customStatus1");
            if (this.value === "其他1") {
                customStatus.classList.remove("hidden");
            } else {
                customStatus.classList.add("hidden");
                customStatus.value = "";
            }
        });
        
        function lockAndSubmit() {
            let className = document.getElementById("class").value.trim();
            let seat = document.getElementById("seat").value.trim();
            let tabletIdPrefix = document.getElementById("tabletIdPrefix").value.trim();
            let tabletIdNumber = document.getElementById("tabletIdNumber").value.trim();
            let status = document.getElementById("beforestatus").value.trim();
            let customStatus = document.getElementById("customStatus1").value.trim();
            
            let tabletId = `${tabletIdPrefix}-${tabletIdNumber}`;
            
            if (status === "其他1") {
                status = customStatus;
            }
            
            if (!className || !seat || !tabletIdPrefix || !tabletIdNumber || !status) {
                alert("請填寫所有必填欄位！");
                return;
            }
            
            document.getElementById("class").classList.add("locked");
            document.getElementById("seat").classList.add("locked");
            document.getElementById("tabletIdPrefix").classList.add("locked");
            document.getElementById("tabletIdNumber").classList.add("locked");
            document.getElementById("beforestatus").classList.add("locked");
            
            let url = new URL('https://script.google.com/macros/s/AKfycbzZiSysFMeFLYXDGODguoA2iTu-szdWmspS5QCaNDfdsznRchOgecDJwV_pPHB4QYvJyA/exec');
            url.searchParams.append('className', className);
            url.searchParams.append('seat', seat);
            url.searchParams.append('tabletId', tabletId);
            url.searchParams.append('status', status);
            
            fetch(url)
                .then(response => response.json())
                .then(data => alert("借用紀錄已提交成功！"))
                .catch(error => alert("提交失敗！"));
        }
        
        function reportIssue() {
            let damage = prompt("請描述新增的問題：");
            if (damage) submitReturn(damage);
        }
        
        function submitReturn(status) {
            let className = document.getElementById("class").value.trim();
            let seat = document.getElementById("seat").value.trim();
            let tabletIdPrefix = document.getElementById("tabletIdPrefix").value.trim();
            let tabletIdNumber = document.getElementById("tabletIdNumber").value.trim();
            let beforeStatus = document.getElementById("beforestatus").value.trim();
            let tabletId = `${tabletIdPrefix}-${tabletIdNumber}`;
            
            let url = new URL('https://script.google.com/macros/s/AKfycbzZiSysFMeFLYXDGODguoA2iTu-szdWmspS5QCaNDfdsznRchOgecDJwV_pPHB4QYvJyA/exec');
            url.searchParams.append('className', className);
            url.searchParams.append('seat', seat);
            url.searchParams.append('tabletId', tabletId);
            url.searchParams.append('beforeStatus', beforeStatus);
            url.searchParams.append('returnStatus', status);
            
            fetch(url)
                .then(response => response.json())
                .then(data => alert("歸還紀錄已提交成功！"))
                .catch(error => alert("提交失敗！"));
        }
    </script>
</body>
</html>
